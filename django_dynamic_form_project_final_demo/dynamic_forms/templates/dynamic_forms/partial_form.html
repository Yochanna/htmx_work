<form hx-post="{% url 'submit-form' %}" hx-target="#form-fields" class="mt-3">
  <!-- Always persist role -->
  <input type="hidden" name="role" value="{{ role }}">

  {{ form.as_p }}

  {% if form.subject %}
    <!-- Preserve teacher name -->
    <input type="hidden" name="name" value="{{ form.name.value|default_if_none:'' }}">

    <!-- Include all key fields when subject changes -->
    <div id="topic-fields"
         hx-get="{% url 'load-topics' %}"
         hx-target="#topic-fields"
         hx-trigger="change from:select[name='subject']"
         hx-include="[name='role'], [name='name'], [name='subject']">
    </div>
  {% endif %}

  <button type="submit" class="btn btn-success mt-2">Submit</button>
</form>
